
> @vantage-lane/admin@0.1.0 test:run /Users/tomita/CascadeProjects/Vantage Lane Admin
> vitest run


 RUN  v3.2.4 /Users/tomita/CascadeProjects/Vantage Lane Admin

 âœ“ apps/admin/entities/booking/lib/bookingStateMachine.test.ts (13 tests) 10ms
 âœ“ apps/admin/entities/payment/model/schema.test.ts (1 test) 3ms
 âœ“ apps/admin/entities/admin/admin.test.ts (1 test) 6ms
 âœ“ apps/admin/entities/operator/operator.test.ts (1 test) 3ms
stderr | app/api/v1/notifications/send-to-driver/route.test.ts > POST /api/v1/notifications/send-to-driver > should return 401 if user is not authenticated
âŒ Authentication failed: Not authenticated

stderr | app/api/v1/notifications/send-to-driver/route.test.ts > POST /api/v1/notifications/send-to-driver > should return 403 if user is not an admin
âŒ Admin user not found: user@test.com

 âœ“ apps/admin/entities/notification/notification.test.ts (1 test) 16ms
stderr | app/api/v1/notifications/send-to-driver/route.test.ts > POST /api/v1/notifications/send-to-driver > should return 403 if user role is not admin/super_admin
âŒ Insufficient permissions: viewer

stderr | app/api/v1/notifications/send-to-driver/route.test.ts > POST /api/v1/notifications/send-to-driver > should return 403 if admin account is inactive
âŒ Account inactive: admin@test.com

stderr | app/api/v1/notifications/send-to-driver/route.test.ts > POST /api/v1/notifications/send-to-driver > should return 400 if driverId is not a valid UUID
âŒ Send notification error: ZodError: [
  {
    "origin": "string",
    "code": "invalid_format",
    "format": "uuid",
    "pattern": "/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/",
    "path": [
      "driverId"
    ],
    "message": "Invalid driver ID format"
  }
]
    at Module.POST [90m(/Users/tomita/CascadeProjects/Vantage Lane Admin/[39mapp/api/v1/notifications/send-to-driver/route.ts:82:50[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/Users/tomita/CascadeProjects/Vantage Lane Admin/[39mapp/api/v1/notifications/send-to-driver/route.test.ts:252:22
    at [90mfile:///Users/tomita/CascadeProjects/Vantage%20Lane%20Admin/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

stderr | app/api/v1/notifications/send-to-driver/route.test.ts > POST /api/v1/notifications/send-to-driver > should return 400 if title exceeds 100 characters
âŒ Send notification error: ZodError: [
  {
    "origin": "string",
    "code": "too_big",
    "maximum": 100,
    "inclusive": true,
    "path": [
      "title"
    ],
    "message": "Title too long"
  }
]
    at Module.POST [90m(/Users/tomita/CascadeProjects/Vantage Lane Admin/[39mapp/api/v1/notifications/send-to-driver/route.ts:82:50[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90m/Users/tomita/CascadeProjects/Vantage Lane Admin/[39mapp/api/v1/notifications/send-to-driver/route.test.ts:295:22
    at [90mfile:///Users/tomita/CascadeProjects/Vantage%20Lane%20Admin/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20

stdout | app/api/v1/notifications/send-to-driver/route.test.ts > POST /api/v1/notifications/send-to-driver > should return 200 and send notification successfully
ğŸ“§ Admin admin@test.com sending notification to driver 123e4567-e89b-12d3-a456-426614174000

stdout | app/api/v1/notifications/send-to-driver/route.test.ts > POST /api/v1/notifications/send-to-driver > should return 200 and send notification successfully
âœ… Notification sent successfully to driver 123e4567-e89b-12d3-a456-426614174000

 âœ“ app/api/v1/notifications/send-to-driver/route.test.ts (7 tests) 146ms
stderr | apps/admin/features/bookings-table/hooks/useBookingCounts.test.ts > useBookingCounts > should handle fetch errors
[useBookingCounts] Error: Error: Network error
    at [90m/Users/tomita/CascadeProjects/Vantage Lane Admin/[39mapps/admin/features/bookings-table/hooks/useBookingCounts.test.ts:61:37
    at [90mfile:///Users/tomita/CascadeProjects/Vantage%20Lane%20Admin/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:155:11
    at [90mfile:///Users/tomita/CascadeProjects/Vantage%20Lane%20Admin/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:26
    at [90mfile:///Users/tomita/CascadeProjects/Vantage%20Lane%20Admin/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///Users/tomita/CascadeProjects/Vantage%20Lane%20Admin/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///Users/tomita/CascadeProjects/Vantage%20Lane%20Admin/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1574:12[90m)[39m
    at runSuite [90m(file:///Users/tomita/CascadeProjects/Vantage%20Lane%20Admin/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///Users/tomita/CascadeProjects/Vantage%20Lane%20Admin/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1729:8[90m)[39m
    at runFiles [90m(file:///Users/tomita/CascadeProjects/Vantage%20Lane%20Admin/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:1787:3[90m)[39m

stderr | apps/admin/features/bookings-table/hooks/useBookingCounts.test.ts > useBookingCounts > should handle non-ok responses
[useBookingCounts] Error: Error: Failed to fetch counts: Internal Server Error
    at fetchCounts [90m(/Users/tomita/CascadeProjects/Vantage Lane Admin/[39mapps/admin/features/bookings-table/hooks/useBookingCounts.ts:38:15[90m)[39m

stderr | apps/admin/features/bookings-table/hooks/useBookingCounts.test.ts > useBookingCounts > should provide refetch function
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/tomita/CascadeProjects/Vantage Lane Admin/node_modules/.pnpm/@testing-library+react@16.3.0_@testing-library+dom@10.4.1_@types+react-dom@18.3.7_@type_59c0e11b10e1a70d511ef984e8664550/node_modules/@testing-library/react/dist/pure.js:329:5)
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/tomita/CascadeProjects/Vantage Lane Admin/node_modules/.pnpm/@testing-library+react@16.3.0_@testing-library+dom@10.4.1_@types+react-dom@18.3.7_@type_59c0e11b10e1a70d511ef984e8664550/node_modules/@testing-library/react/dist/pure.js:329:5)

stderr | apps/admin/features/bookings-table/hooks/useBookingCounts.test.ts > useBookingCounts > should provide refetch function
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/tomita/CascadeProjects/Vantage Lane Admin/node_modules/.pnpm/@testing-library+react@16.3.0_@testing-library+dom@10.4.1_@types+react-dom@18.3.7_@type_59c0e11b10e1a70d511ef984e8664550/node_modules/@testing-library/react/dist/pure.js:329:5)
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/tomita/CascadeProjects/Vantage Lane Admin/node_modules/.pnpm/@testing-library+react@16.3.0_@testing-library+dom@10.4.1_@types+react-dom@18.3.7_@type_59c0e11b10e1a70d511ef984e8664550/node_modules/@testing-library/react/dist/pure.js:329:5)

stderr | apps/admin/features/bookings-table/hooks/useBookingCounts.test.ts > useBookingCounts > should handle refetch errors
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/tomita/CascadeProjects/Vantage Lane Admin/node_modules/.pnpm/@testing-library+react@16.3.0_@testing-library+dom@10.4.1_@types+react-dom@18.3.7_@type_59c0e11b10e1a70d511ef984e8664550/node_modules/@testing-library/react/dist/pure.js:329:5)
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/tomita/CascadeProjects/Vantage Lane Admin/node_modules/.pnpm/@testing-library+react@16.3.0_@testing-library+dom@10.4.1_@types+react-dom@18.3.7_@type_59c0e11b10e1a70d511ef984e8664550/node_modules/@testing-library/react/dist/pure.js:329:5)

stderr | apps/admin/features/bookings-table/hooks/useBookingCounts.test.ts > useBookingCounts > should handle refetch errors
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/tomita/CascadeProjects/Vantage Lane Admin/node_modules/.pnpm/@testing-library+react@16.3.0_@testing-library+dom@10.4.1_@types+react-dom@18.3.7_@type_59c0e11b10e1a70d511ef984e8664550/node_modules/@testing-library/react/dist/pure.js:329:5)
[useBookingCounts] Error: Error: Refetch error
    at [90m/Users/tomita/CascadeProjects/Vantage Lane Admin/[39mapps/admin/features/bookings-table/hooks/useBookingCounts.test.ts:138:37
    at [90mfile:///Users/tomita/CascadeProjects/Vantage%20Lane%20Admin/[39mnode_modules/[4m.pnpm[24m/@vitest+runner@3.2.4/node_modules/[4m@vitest[24m/runner/dist/chunk-hooks.js:752:20
Warning: An update to TestComponent inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act
    at TestComponent (/Users/tomita/CascadeProjects/Vantage Lane Admin/node_modules/.pnpm/@testing-library+react@16.3.0_@testing-library+dom@10.4.1_@types+react-dom@18.3.7_@type_59c0e11b10e1a70d511ef984e8664550/node_modules/@testing-library/react/dist/pure.js:329:5)

 âœ“ apps/admin/features/bookings-table/hooks/useBookingCounts.test.ts (7 tests) 442ms
 âœ“ apps/admin/features/settings-permissions/settings-permissions.test.ts (3 tests) 2ms
 âœ“ apps/admin/entities/user/model/schema.test.ts (1 test) 7ms
 âœ“ apps/admin/features/disputes-table/disputes-table.test.ts (1 test) 1ms
 âœ“ apps/admin/entities/dispute/dispute.test.ts (1 test) 6ms
 âœ“ apps/admin/entities/invoice/invoice.test.ts (1 test) 10ms
 âœ“ apps/admin/entities/refund/refund.test.ts (1 test) 5ms
 âœ“ apps/admin/entities/driver/driver.test.ts (1 test) 3ms
 âœ“ apps/admin/features/admins-table/admins-table.test.ts (1 test) 4ms
 âœ“ apps/admin/tests/rls/rbac-cleanup.test.ts (13 tests) 9ms
 âœ“ apps/admin/features/customers-table/customers-table.test.ts (1 test) 1ms
 âœ“ apps/admin/tests/contracts/payments.test.ts (4 tests) 4ms
 âœ“ apps/admin/tests/contracts/bookings.test.ts (7 tests) 4ms
 âœ“ apps/admin/features/refunds-table/refunds-table.test.ts (1 test) 3ms
 âœ“ apps/admin/features/payments-overview/payments-overview.test.ts (1 test) 3ms
 âœ“ apps/admin/features/drivers-pending/drivers-pending.test.ts (1 test) 2ms
 âœ“ apps/admin/entities/booking/lib/calculatePrice.test.ts (9 tests) 4ms
 âœ“ apps/admin/tests/contracts/users.test.ts (5 tests) 5ms
 âœ“ apps/admin/features/notification-center/notification-center.test.ts (1 test) 1ms
 âœ“ apps/admin/features/settings-vehicle-categories/settings-vehicle-categories.test.ts (1 test) 3ms
 âœ“ apps/admin/entities/customer/customer.test.ts (1 test) 57ms
 âœ“ apps/admin/features/invoices-table/invoices-table.test.ts (1 test) 1ms
 âœ“ apps/admin/features/operator-drivers-list/operator-drivers-list.test.ts (1 test) 1ms
 âœ“ apps/admin/features/document-viewer/document-viewer.test.ts (1 test) 2ms
 âœ“ apps/admin/features/bookings-table/components/expanded/TripTypeSection.test.ts (1 test) 1ms
 âœ“ apps/admin/features/prices-management/prices-management.test.ts (2 tests) 1ms
 âœ“ apps/admin/features/user-create-modal/user-create-modal.test.ts (1 test) 3ms
 âœ“ apps/admin/entities/user/api/listAllUsers.test.ts (1 test) 4ms
 âœ“ apps/admin/features/driver-verification/driver-verification.test.ts (1 test) 3ms
 âœ“ apps/admin/features/users-table-base/users-table-base.test.ts (1 test) 2ms
 âœ“ apps/admin/features/drivers-table/drivers-table.test.ts (1 test) 2ms
 âœ“ apps/admin/features/operator-dashboard/operator-dashboard.test.ts (1 test) 1ms
 âœ“ apps/admin/features/payouts-table/index.test.ts (1 test) 1ms
 âœ“ apps/admin/features/payments-table/index.test.ts (1 test) 1ms
 âœ“ apps/admin/features/settings-commissions/settings-commissions.test.ts (1 test) 4ms
 âœ“ apps/admin/features/user-edit-modal/user-edit-modal.test.ts (1 test) 2ms
 âœ“ apps/admin/features/bookings-table/components/BookingsWithTabs.test.ts (1 test) 2ms
 âœ“ apps/admin/features/operators-table/operators-table.test.ts (1 test) 2ms
 âœ“ apps/admin/features/user-view-modal/user-view-modal.test.ts (1 test) 1ms
 âœ“ apps/admin/features/users-table/index.test.ts (1 test) 1ms

 Test Files  46 passed (46)
      Tests  106 passed (106)
   Start at  23:38:46
   Duration  8.58s (transform 2.76s, setup 0ms, collect 10.35s, tests 797ms, environment 32.33s, prepare 5.59s)

