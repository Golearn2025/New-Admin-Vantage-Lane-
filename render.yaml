# Render Blueprint
# https://render.com/docs/blueprint-spec

services:
  # Web Service - Next.js Admin Dashboard
  - type: web
    name: vantage-admin
    runtime: node
    # frankfurt = closest region to Supabase eu-west-2 (London)
    # CRITICAL: oregon caused ConnectTimeoutError to Supabase EU
    region: frankfurt
    plan: standard # paid plan - eliminates cold start 502s (starter = free tier with sleep)
    
    # Build & Start
    # Use pnpm to match workspace lockfile (pnpm-lock.yaml)
    buildCommand: npm install -g pnpm && pnpm install --frozen-lockfile && pnpm run build
    startCommand: pnpm run start
    
    # Environment
    env: node
    
    # Health Check
    healthCheckPath: /api/health
    
    # Auto-deploy
    branch: main
    
    # Environment Variables
    # NOTE: Set these in Render Dashboard (they won't be committed)
    envVars:
      - key: NODE_ENV
        value: production

      # CRITICAL: Must match your Render service URL
      - key: NEXT_PUBLIC_SITE_URL
        value: https://admin.vantage-lane.com

      - key: NEXT_PUBLIC_SUPABASE_URL
        sync: false # Set manually in dashboard
      
      - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
        sync: false
      
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      
      - key: NEXT_PUBLIC_GOOGLE_MAPS_API_KEY
        sync: false
      
      - key: GOOGLE_MAPS_API_KEY_SERVER
        sync: false

      - key: NEXT_PUBLIC_MAPBOX_ACCESS_TOKEN
        sync: false
